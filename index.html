<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fl√¢nerie - The Art of Urban Wandering</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700;800&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            background: #0a0a0a;
            color: #8DBCC0;
            --accent-color: #6B9B9E;
            --accent-light: #8DBCC0;
        }
        
        body.choreography-active {
            overflow: hidden;
            height: 100vh;
            position: fixed;
            width: 100%;
        }
        
        /* Navigation - Centered, No Logo */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            z-index: 1000;
            border-bottom: 1px solid rgba(107, 155, 158, 0.2);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            gap: 3rem;
            list-style: none;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--accent-light);
            font-weight: 500;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }
        
        .nav-links a:hover {
            color: #ffffff;
        }
        
        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            padding: 6rem 2rem 4rem;
            background: url('character-bg.png') center/cover fixed;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.75);
            backdrop-filter: blur(8px);
            z-index: 1;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 900px;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 7rem;
            font-weight: 400;
            color: var(--accent-light);
            margin-bottom: 1rem;
            letter-spacing: 3px;
            text-shadow: 0 5px 30px rgba(0, 0, 0, 0.8);
        }
        
        .hero-subtitle {
            font-size: 1.8rem;
            color: var(--accent-light);
            font-weight: 300;
            margin-bottom: 2rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
        }
        
        .hero-logo-btn {
            width: 200px;
            height: 200px;
            margin: 0 auto 2rem;
            border-radius: 50%;
            background: url('character-logo.png') center/cover;
            border: 5px solid var(--accent-color);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(107, 155, 158, 0.4);
            animation: float 3s ease-in-out infinite;
        }
        
        .hero-logo-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 60px rgba(107, 155, 158, 0.6);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Rotating phrases below logo */
        .rotating-text-container {
            min-height: 50px;
            position: relative;
            margin-bottom: 1rem;
        }
        
        .rotating-text {
            position: relative;
            width: 100%;
            text-align: center;
        }
        
        .rotating-text span {
            position: absolute;
            width: 100%;
            left: 0;
            opacity: 0;
            color: var(--accent-light);
            font-size: 1.2rem;
            font-weight: 300;
            font-style: italic;
            transition: opacity 1s ease-in-out;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
        }
        
        .rotating-text span.active {
            opacity: 1;
        }
        
        .scroll-hint {
            position: absolute;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            color: var(--accent-light);
            font-size: 0.9rem;
            opacity: 0.7;
            animation: bounce 2s ease-in-out infinite;
            z-index: 2;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        /* Main Content */
        .main-content {
            position: relative;
            background: #0a0a0a;
            padding: 6.5rem 0 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        /* Info Section - Definition */
        .info-section {
            text-align: center;
            padding: 1.5rem 0 0.5rem;
            max-width: 900px;
            margin: 0 auto 1.5rem;
        }
        
        .definition-box-animated {
            margin-bottom: 1.2rem;
            text-align: left;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            background: rgba(30, 30, 30, 0.8);
            padding: 1.3rem;
            border-radius: 15px;
            border-left: 4px solid var(--accent-color);
        }
        
        .definition-box-animated h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.6rem;
            font-weight: 400;
            color: var(--accent-light);
            margin-bottom: 0.4rem;
        }
        
        .definition-box-animated p {
            color: var(--accent-light);
            line-height: 1.7;
        }
        
        /* Welcome Section - Wider */
        #welcome-section {
            text-align: left;
            max-width: 1200px;
            margin: 0 auto 2rem;
            background: rgba(30, 30, 30, 0.5);
            padding: 2rem 3rem;
            border-radius: 20px;
        }
        
        #welcome-section h3 {
            font-family: 'Playfair Display', serif;
            color: var(--accent-color);
            font-size: 2.5rem;
            margin-bottom: 1.2rem;
        }
        
        #welcome-section p {
            font-size: 0.95rem;
            color: var(--accent-light);
            line-height: 1.65;
            margin-bottom: 0.9rem;
        }
        
        #welcome-section p:last-of-type {
            margin-bottom: 0;
        }
        
        #tagline-reveal {
            margin-top: 1rem;
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--accent-color);
            font-style: italic;
            font-weight: 700;
            text-align: center;
        }
        
        /* Feature Cards - 2x2 Grid */
        .features-section {
            min-height: auto;
            padding: 3rem 2rem 2rem;
            scroll-margin-top: 80px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
        }
        
        @media (max-width: 968px) {
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
        }
        
        .feature-card-large {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid rgba(107, 155, 158, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            max-height: 250px;
        }
        
        .feature-card-large:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(107, 155, 158, 0.3);
            border-color: var(--accent-color);
        }
        
        .feature-content {
            position: relative;
            z-index: 3;
            text-align: center;
            width: 100%;
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 1rem;
        }
        
        .feature-card-large h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--accent-light);
            margin-bottom: 0.8rem;
        }
        
        .feature-card-large p {
            font-size: 1rem;
            color: #d4d4d4;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .feature-btn {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .feature-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(107, 155, 158, 0.5);
        }
        
        /* Upcoming Sections */
        .upcoming-section {
            background: linear-gradient(135deg, rgba(107, 155, 158, 0.15), rgba(141, 188, 192, 0.15));
            border: 2px solid rgba(107, 155, 158, 0.3);
            border-radius: 25px;
            padding: 2rem;
            margin: 0 auto 3rem;
            max-width: 1400px;
            min-height: auto;
            scroll-margin-top: 140px;
        }
        
        .upcoming-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--accent-color);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .upcoming-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2.5rem;
        }
        
        @media (max-width: 1200px) {
            .upcoming-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .upcoming-cards {
                grid-template-columns: 1fr;
            }
        }
        
        .upcoming-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 1.2rem;
            border: 2px solid rgba(107, 155, 158, 0.3);
            transition: all 0.3s ease;
        }
        
        .upcoming-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: 0 10px 40px rgba(107, 155, 158, 0.3);
        }
        
        .upcoming-card h3 {
            color: var(--accent-light);
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .upcoming-card p {
            color: var(--accent-light);
            line-height: 1.5;
            margin: 0.3rem 0;
            font-size: 0.95rem;
        }
        
        .event-type {
            display: inline-block;
            background: var(--accent-light);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.75rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }
        
        /* Footer */
        footer {
            background: rgba(10, 10, 10, 0.98);
            color: var(--accent-light);
            padding: 2rem 2rem 1rem;
            border-top: 2px solid rgba(107, 155, 158, 0.3);
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .footer-section h4 {
            color: var(--accent-color);
            margin-bottom: 1rem;
        }
        
        .footer-section a {
            color: var(--accent-light);
            text-decoration: none;
            line-height: 2;
            transition: color 0.3s;
        }
        
        .footer-section a:hover {
            color: #ffffff;
        }
        
        .footer-section ul {
            list-style: none;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(107, 155, 158, 0.2);
            color: #999;
        }
        
        /* SLIDESHOW - CORRECTED */
        .slideshow-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #0a0a0a;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .slideshow-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            padding: 4rem 2rem;
        }
        
        .slide.active {
            opacity: 1;
        }
        
        .slide-content {
            text-align: center;
            max-width: 800px;
            width: 100%;
        }
        
        #slide-typewriter-with-image {
            justify-content: flex-start;
            padding-top: 15%;
        }
        
        #slide-typewriter-with-image .typewriter-section {
            margin-bottom: 3rem;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #slide-typewriter-with-image .image-section {
            opacity: 0;
            transition: opacity 4s ease-in;
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        #slide-typewriter-with-image .image-section.fading {
            opacity: 1;
        }
        
        #slide-paragraph-with-image {
            justify-content: flex-start;
            padding-top: 8%;
        }
        
        #slide-paragraph-with-image .paragraph-section {
            margin-bottom: 3rem;
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        #slide-paragraph-with-image .image-section {
            opacity: 0;
            transition: opacity 3s ease-in;
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        #slide-paragraph-with-image .image-section.fading {
            opacity: 1;
        }
        
        #slide-paragraph-with-image .you-text {
            opacity: 0;
            transition: opacity 1.5s ease-in;
            font-family: 'Playfair Display', serif;
            color: var(--accent-color);
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        #slide-paragraph-with-image .you-text.showing {
            opacity: 1;
        }
        
        #slide-welcome #welcome-text {
            font-family: 'Playfair Display', serif;
            color: var(--accent-color);
            font-size: 3rem;
            font-weight: 600;
            transition: transform 2s ease-out;
        }
        
        #slide-welcome #welcome-text.move-up {
            transform: translateY(-40px);
        }
        
        #slide-welcome #tagline-text {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--accent-color);
            font-style: italic;
            font-weight: 700;
            opacity: 0;
            margin-top: 2rem;
            transition: opacity 1s ease-in;
        }
        
        #slide-welcome #tagline-text.fade-in {
            opacity: 1;
        }
        
        #slideshow-typewriter-sentence {
            font-family: 'Crimson Text', serif;
            font-size: 1.6rem;
            color: var(--accent-light);
            font-weight: 600;
            text-align: center;
            min-height: 50px;
        }
        
        .slideshow-controls {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 10001;
            display: flex;
            gap: 1rem;
        }
        
        .slideshow-controls button {
            background: rgba(107, 155, 158, 0.3);
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .slideshow-controls button:hover {
            background: var(--accent-color);
            color: #0a0a0a;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 3.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.2rem;
            }
            
            .hero-logo-btn {
                width: 150px;
                height: 150px;
            }
            
            .nav-links {
                gap: 1rem;
                font-size: 0.9rem;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            #welcome-section {
                padding: 2rem;
            }
            
            .definition-box-animated h2 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- SLIDESHOW -->
    <div id="slideshow-overlay" class="slideshow-overlay">
        <div class="slideshow-controls">
            <button id="rewind-btn" title="Restart">‚Ü∫</button>
            <button id="pause-btn" title="Pause/Play">‚è∏</button>
            <button id="skip-btn" title="Skip">‚è≠</button>
        </div>
        
        <!-- Slide 1: Definition -->
        <div class="slide active" id="slide-definition">
            <div class="slide-content">
                <h2 style="font-family: 'Playfair Display', serif; font-size: 4rem; color: var(--accent-light); margin-bottom: 1rem;">fl√¢nerie</h2>
                <p style="font-size: 1.2rem; color: var(--accent-light); margin-bottom: 2rem; font-style: italic;">| Ààfl…ëÀên…ôri |</p>
                <p style="font-size: 1.6rem; color: var(--accent-light); line-height: 1.8;">The art of leisurely urban exploration;<br>mindful wandering through city streets<br>with intention and curiosity.</p>
            </div>
        </div>
        
        <!-- Slide 2: Typewriter + Image -->
        <div class="slide" id="slide-typewriter-with-image">
            <div class="typewriter-section">
                <h3 style="font-family: 'Playfair Display', serif; color: var(--accent-color); font-size: 2.8rem; margin-bottom: 3rem; text-align: center;">Take Back Your Main Street</h3>
                <p id="slideshow-typewriter-sentence"></p>
            </div>
            
            <div class="image-section" id="empty-street-section">
                <img src="empty-street.png" alt="Empty street" style="max-width: 500px; width: 80%; height: auto; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
            </div>
        </div>
        
        <!-- Slide 3: Paragraph + YOU + Image -->
        <div class="slide" id="slide-paragraph-with-image">
            <div class="paragraph-section">
                <p style="font-size: 1.3rem; color: var(--accent-light); line-height: 1.9; text-align: center; max-width: 800px;">
                    Search engines direct you to chains. Online shopping replaces neighborhood stores. Meanwhile, the caf√© owner who remembers your name can't make rent. Small businesses don't have marketing budgets or algorithms working for them ‚Äî they have...
                </p>
            </div>
            
            <div class="you-text" id="you-text">YOU</div>
            
            <div class="image-section" id="shopping-street-section">
                <img src="shopping-street.png" alt="Shopping street" style="max-width: 500px; width: 80%; height: auto; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
            </div>
        </div>
        
        <!-- Slide 4: Welcome -->
        <div class="slide" id="slide-welcome">
            <div class="slide-content">
                <h3 id="welcome-text">Welcome to Fl√¢nerie</h3>
                <p id="tagline-text">
                    Share your journey.<br>Retrace theirs.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="javascript:void(0)" onclick="scrollToContent()">How It Works</a></li>
                <li><a href="javascript:void(0)" onclick="scrollToExplore()">Explore</a></li>
                <li><a href="for-businesses.html">For Businesses</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Fl√¢nerie</h1>
            <p class="hero-subtitle">The art of urban wandering.</p>
            <div class="hero-logo-btn" onclick="scrollToContent()"></div>
            
            <!-- Rotating phrases below logo -->
            <div class="rotating-text-container">
                <div class="rotating-text">
                    <span class="active">Wander well.</span>
                    <span>Walk kindly.</span>
                    <span>Support local business.</span>
                    <span>Discover hidden gems in your neighborhood.</span>
                    <span>Turn ordinary walks into extraordinary adventures.</span>
                    <span>Connect with your community, one step at a time.</span>
                    <span>Every block has a story to tell.</span>
                    <span>Shop small, feel big.</span>
                    <span>Find your city's secrets.</span>
                    <span>Life moves fast - walk slower.</span>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Definition Section -->
            <section class="info-section">
                <div class="definition-box-animated">
                    <h2>fl√¢nerie</h2>
                    <p style="font-size: 1rem; color: var(--accent-light); margin-bottom: 0.3rem;">
                        | Ààfl…ëÀên…ôri | <span style="font-style: italic;">noun</span>
                    </p>
                    <div style="width: 60px; height: 1px; background: #555; margin: 1rem 0;"></div>
                    <p style="font-size: 1.3rem; color: var(--accent-light); line-height: 1.7;">
                        The art of leisurely urban exploration; mindful wandering through city streets with intention and curiosity.
                    </p>
                </div>
                
                <!-- Welcome Section -->
                <div id="welcome-section">
                    <h3>Welcome to Fl√¢nerie</h3>
                    
                    <p>
                        We turn ordinary walks into extraordinary mini-adventures. Rooted in French culture, fl√¢nerie celebrates <strong style="color: var(--accent-color);">the art of strolling</strong> ‚Äî observing city life with intention instead of rushing through it. It's <strong style="color: var(--accent-color);">cultural appreciation</strong> in motion: slowing down enough to notice the character and charm built into the everyday.
                    </p>
                    
                    <p>
                        With Fl√¢nerie, you can explore neighborhoods at your own pace or chart your own path. Our routes guide you from cozy caf√©s and local markets to boutique shops, art galleries, bookstores, parks, and hidden corners ‚Äî each designed for <strong style="color: var(--accent-color);">mindful wandering</strong> and curiosity-led discovery. Search routes shared by others, map your upcoming outings, browse local events, or gather friends for a <strong style="color: var(--accent-color);">Shopping Swarm</strong> ‚Äî a collective walk that turns routine errands into moments of connection and community support.
                    </p>
                    
                    <p>
                        <strong style="color: var(--accent-color);">Your route to that tiny coffee roaster? Someone else's new favorite spot. Your Shopping Swarm? A local merchant's best weekend in months.</strong> This is how communities strengthen themselves ‚Äî one walk, one recommendation, one conscious choice at a time.
                    </p>
                </div>
                
                <p id="tagline-reveal">Share your journey. Retrace theirs.</p>
            </section>
            
            <!-- Feature Cards - 4 in a row -->
            <div id="features-content" class="features-section">
                <div class="feature-grid">
                    <div class="feature-card-large">
                        <div class="feature-content">
                            <div class="feature-icon">üìç</div>
                            <h3>Share Your Journey</h3>
                            <p>Plot your favorite routes</p>
                            <button class="feature-btn" onclick="toggleSection('journey-map')">Start Mapping</button>
                        </div>
                    </div>
                    
                    <div class="feature-card-large">
                        <div class="feature-content">
                            <div class="feature-icon">üîç</div>
                            <h3>Search Routes</h3>
                            <p>Discover curated paths</p>
                            <button class="feature-btn" onclick="toggleSection('search')">Explore Routes</button>
                        </div>
                    </div>
                    
                    <div class="feature-card-large">
                        <div class="feature-content">
                            <div class="feature-icon">üõçÔ∏è</div>
                            <h3>Shopping Swarms</h3>
                            <p>Join community walks</p>
                            <button class="feature-btn" onclick="toggleSection('swarms')">View Swarms</button>
                        </div>
                    </div>
                    
                    <div class="feature-card-large">
                        <div class="feature-content">
                            <div class="feature-icon">üéâ</div>
                            <h3>Local Events</h3>
                            <p>Discover celebrations</p>
                            <button class="feature-btn" onclick="toggleSection('events')">Browse Events</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h4>Fl√¢nerie</h4>
                <p>The art of urban wandering.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="#contact">Contact</a></li>
                    <li><a href="for-businesses.html">For Businesses</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Community</h4>
                <ul>
                    <li><a href="#blog">Blog</a></li>
                    <li><a href="#stories">Stories</a></li>
                    <li><a href="#events">Events</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Connect</h4>
                <ul>
                    <li><a href="#instagram">Instagram</a></li>
                    <li><a href="#twitter">Twitter</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Fl√¢nerie. All rights reserved. Made with ‚ù§Ô∏è for urban explorers.</p>
        </div>
    </footer>
    
    <script>
        // SLIDESHOW - APPROVED TIMING
        const typewriterText = "Every year, 200,000 small businesses close in the U.S. alone.";
        let charIndex = 0;
        
        function startSlideshow() {
            const slideshowOverlay = document.getElementById('slideshow-overlay');
            document.body.classList.add('choreography-active');
            slideshowOverlay.classList.add('active');
            
            // Slide 1: Definition (4 sec)
            setTimeout(() => {
                document.getElementById('slide-definition').classList.remove('active');
                document.getElementById('slide-typewriter-with-image').classList.add('active');
                
                // Start image fade when typing starts (slower now - 4s)
                setTimeout(() => {
                    document.getElementById('empty-street-section').classList.add('fading');
                }, 100);
                
                // Start typewriter
                slideshowTypewriter(() => {
                    // Hold for 5 seconds after typing finishes
                    setTimeout(() => {
                        document.getElementById('slide-typewriter-with-image').classList.remove('active');
                        document.getElementById('slide-paragraph-with-image').classList.add('active');
                        
                        // Paragraph HOLDS for 4 seconds (people can read)
                        setTimeout(() => {
                            // YOU fades in
                            document.getElementById('you-text').classList.add('showing');
                            
                            // Wait for YOU to finish fading (1.5 sec), then start image
                            setTimeout(() => {
                                document.getElementById('shopping-street-section').classList.add('fading');
                                
                                // Wait for image to finish (3 sec), then hold
                                setTimeout(() => {
                                    // Everything holds for 3 seconds
                                    setTimeout(() => {
                                        document.getElementById('slide-paragraph-with-image').classList.remove('active');
                                        document.getElementById('slide-welcome').classList.add('active');
                                        
                                        // After 2 sec, move Welcome up and fade in tagline
                                        setTimeout(() => {
                                            document.getElementById('welcome-text').classList.add('move-up');
                                            document.getElementById('tagline-text').classList.add('fade-in');
                                            
                                            // Hold for 4 sec, then END
                                            setTimeout(() => {
                                                slideshowOverlay.style.transition = 'opacity 1s ease-out';
                                                slideshowOverlay.style.opacity = '0';
                                                
                                                setTimeout(() => {
                                                    slideshowOverlay.style.display = 'none';
                                                    document.body.classList.remove('choreography-active');
                                                }, 1000);
                                            }, 4000);
                                        }, 2000);
                                    }, 3000);
                                }, 3000);
                            }, 1500);
                        }, 4000);
                    }, 5000);
                });
            }, 4000);
        }
        
        function slideshowTypewriter(callback) {
            const element = document.getElementById('slideshow-typewriter-sentence');
            element.textContent = '';
            charIndex = 0;
            
            function type() {
                if (charIndex < typewriterText.length) {
                    element.textContent += typewriterText.charAt(charIndex);
                    charIndex++;
                    setTimeout(type, 50);
                } else {
                    callback();
                }
            }
            type();
        }
        
        // Slideshow controls
        document.getElementById('skip-btn').addEventListener('click', function() {
            const slideshowOverlay = document.getElementById('slideshow-overlay');
            slideshowOverlay.style.transition = 'opacity 0.5s ease-out';
            slideshowOverlay.style.opacity = '0';
            
            setTimeout(() => {
                slideshowOverlay.style.display = 'none';
                document.body.classList.remove('choreography-active');
            }, 500);
        });
        
        document.getElementById('pause-btn').addEventListener('click', function() {
            this.textContent = this.textContent === '‚è∏' ? '‚ñ∂' : '‚è∏';
        });
        
        document.getElementById('rewind-btn').addEventListener('click', function() {
            charIndex = 0;
            document.getElementById('slideshow-typewriter-sentence').textContent = '';
            // Reset all states
            document.querySelectorAll('.fading, .showing, .move-up, .fade-in').forEach(el => {
                el.classList.remove('fading', 'showing', 'move-up', 'fade-in');
            });
            startSlideshow();
        });
        
        startSlideshow();
        
        // Rotating hero phrases
        let currentHeroTextIndex = 0;
        const heroTextSpans = document.querySelectorAll('.hero .rotating-text span');
        
        function rotateHeroText() {
            heroTextSpans[currentHeroTextIndex].classList.remove('active');
            currentHeroTextIndex = (currentHeroTextIndex + 1) % heroTextSpans.length;
            heroTextSpans[currentHeroTextIndex].classList.add('active');
        }
        
        setInterval(rotateHeroText, 3000);
        
        // Scroll to content
        function scrollToContent() {
            document.querySelector('.main-content').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToExplore() {
            document.getElementById('features-content').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Make globally accessible
        window.scrollToContent = scrollToContent;
        window.scrollToExplore = scrollToExplore;
    </script>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        // ===== FIREBASE CONFIGURATION =====
        const firebaseConfig = {
            apiKey: "AIzaSyB4nznaJQ1VGNDylnfN5J9MW74Thm8XoS8",
            authDomain: "flanerie-70dfd.firebaseapp.com",
            databaseURL: "https://flanerie-70dfd-default-rtdb.firebaseio.com",
            projectId: "flanerie-70dfd",
            storageBucket: "flanerie-70dfd.firebasestorage.app",
            messagingSenderId: "367532686554",
            appId: "1:367532686554:web:0373f528284844cf5e79e3"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        window.database = firebase.database();
        const database = window.database; // Keep local reference for this script block
        
        // Check if Firebase is configured
        if (firebaseConfig.apiKey === "YOUR_API_KEY") {
            console.warn('%c‚ö†Ô∏è FIREBASE NOT CONFIGURED YET!', 'color: orange; font-size: 20px; font-weight: bold;');
            console.log('%cSTEPS TO SET UP FIREBASE:', 'color: cyan; font-size: 16px; font-weight: bold;');
            console.log('1. Go to https://console.firebase.google.com/');
            console.log('2. Create a new project (name it "flanerie")');
            console.log('3. Click "Realtime Database" in left menu ‚Üí Create Database');
            console.log('4. Choose "Start in test mode" ‚Üí Enable');
            console.log('5. Click the gear icon ‚Üí Project settings ‚Üí Scroll down');
            console.log('6. Click "Web" icon (</>) ‚Üí Register app');
            console.log('7. Copy the firebaseConfig object and replace lines 1163-1170 in this HTML');
            console.log('%cData will only save to localStorage until Firebase is configured!', 'color: yellow;');
        } else {
            console.log('%c‚úÖ Firebase is configured and ready!', 'color: green; font-size: 16px; font-weight: bold;');
            console.log('Database URL:', firebaseConfig.databaseURL);
        }
        
        // ===== DATABASE HELPER FUNCTIONS =====
        // These wrap Firebase calls so we can easily switch databases later
        
        // Geocode address to get lat/lng coordinates
        async function geocodeAddress(address) {
            try {
                const accessToken = 'pk.eyJ1IjoiaGlnaGRlZnBhbnRzIiwiYSI6ImNtaHpiNGt0NzBsNTIyam9saW45YmQ0Z3gifQ.EPETOMFI41QInYccb4Cehg';
                const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(address)}.json?access_token=${accessToken}&limit=1`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.features && data.features.length > 0) {
                    const [lng, lat] = data.features[0].center;
                    console.log(`üó∫Ô∏è Geocoded "${address}"`);
                    console.log(`   Mapbox returned: [lng: ${lng}, lat: ${lat}]`);
                    console.log(`   Saving as: { lat: ${lat}, lng: ${lng} }`);
                    console.log(`   Full address: ${data.features[0].place_name}`);
                    return { lat, lng, fullAddress: data.features[0].place_name };
                }
                return null;
            } catch (error) {
                console.error('Geocoding error:', error);
                return null;
            }
        }
        
        // ===== DATABASE HELPER FUNCTIONS =====
        
        // Save event to Firebase
        async function saveEventToFirebase(eventData) {
            try {
                const newEventRef = database.ref('events').push();
                await newEventRef.set({
                    ...eventData,
                    id: newEventRef.key,
                    created: new Date().toISOString()
                });
                console.log('Event saved to Firebase:', newEventRef.key);
                return newEventRef.key;
            } catch (error) {
                console.error('Error saving event:', error);
                showToast('Error saving event. Please try again.');
            }
        }
        
        // Save swarm to Firebase
        async function saveSwarmToFirebase(swarmData) {
            try {
                const newSwarmRef = database.ref('swarms').push();
                await newSwarmRef.set({
                    ...swarmData,
                    id: newSwarmRef.key,
                    created: new Date().toISOString()
                });
                console.log('Swarm saved to Firebase:', newSwarmRef.key);
                return newSwarmRef.key;
            } catch (error) {
                console.error('Error saving swarm:', error);
                showToast('Error saving swarm. Please try again.');
            }
        }
        
        // Get all events from Firebase
        async function getAllEvents() {
            try {
                const snapshot = await database.ref('events').once('value');
                const events = [];
                snapshot.forEach((childSnapshot) => {
                    events.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                console.log('Loaded events from Firebase:', events.length);
                return events;
            } catch (error) {
                console.error('Error loading events:', error);
                return [];
            }
        }
        
        // Get all swarms from Firebase
        async function getAllSwarms() {
            try {
                const snapshot = await database.ref('swarms').once('value');
                const swarms = [];
                snapshot.forEach((childSnapshot) => {
                    swarms.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                console.log('Loaded swarms from Firebase:', swarms.length);
                return swarms;
            } catch (error) {
                console.error('Error loading swarms:', error);
                return [];
            }
        }
        
        // Update interest count in Firebase
        async function updateInterestCount(type, id, newCount) {
            try {
                const path = type === 'swarm' ? `swarms/${id}` : `events/${id}`;
                await database.ref(path).update({
                    interested: newCount
                });
                console.log(`Updated interest count for ${type} ${id}: ${newCount}`);
            } catch (error) {
                console.error('Error updating interest:', error);
            }
        }
        
        // Listen for real-time updates (optional - shows changes instantly)
        function listenForEventUpdates(callback) {
            database.ref('events').on('value', (snapshot) => {
                const events = [];
                snapshot.forEach((childSnapshot) => {
                    events.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                callback(events);
            });
        }
        
        function listenForSwarmUpdates(callback) {
            database.ref('swarms').on('value', (snapshot) => {
                const swarms = [];
                snapshot.forEach((childSnapshot) => {
                    swarms.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                callback(swarms);
            });
        }
        
        // Get all routes from Firebase
        function getAllRoutes() {
            return new Promise((resolve) => {
                database.ref('routes').once('value', (snapshot) => {
                    const routes = [];
                    snapshot.forEach((childSnapshot) => {
                        routes.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });
                    resolve(routes);
                });
            });
        }
        
        function listenForRouteUpdates(callback) {
            database.ref('routes').on('value', (snapshot) => {
                const routes = [];
                snapshot.forEach((childSnapshot) => {
                    routes.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                callback(routes);
            });
        }
    </script>
    
    <script>
        // Map variables
        let journeyMap = null;
        let searchMap = null;
        let swarmMap = null;
        let eventMap = null;
        let routeMarkers = [];
        let routePath = null;
        let routeCoordinates = [];
        
        // Toggle Sections - Opens fullscreen modal with maps
        function toggleSection(sectionId, highlightId = null) {
            // Lock background scrolling - use the choreography-active class
            document.body.classList.add('choreography-active');
            
            // Create fullscreen modal
            const modal = document.createElement('div');
            modal.className = 'modal-fullscreen show';
            modal.id = 'fullscreen-' + sectionId;
            modal.style.cssText = 'display: block; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100vh; background-color: rgba(10, 10, 10, 0.98);';
            
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '&times;';
            closeBtn.style.cssText = 'position: fixed; top: 2rem; right: 2rem; width: 50px; height: 50px; background: rgba(107, 155, 158, 0.9); border: none; border-radius: 50%; color: white; font-size: 2rem; cursor: pointer; z-index: 2001;';
            closeBtn.onclick = () => {
                modal.remove();
                // Unlock background scrolling
                document.body.classList.remove('choreography-active');
                // Reset map variables so they can be recreated
                journeyMap = null;
                searchMap = null;
                swarmMap = null;
                eventMap = null;
            };
            
            const content = document.createElement('div');
            content.style.cssText = 'padding: 3rem; max-width: 1600px; margin: 0 auto; padding-bottom: 4rem; height: 100vh; overflow-y: auto;';
            
            // Create content based on section
            if (sectionId === 'journey-map') {
                content.innerHTML = `
                    <h2 style="color: var(--accent-color); margin-bottom: 1rem;">Share Your Journey</h2>
                    <p style="color: #d4d4d4; margin-bottom: 1.5rem;">Search for a location or business to get started, or click on the map to add waypoints and create your custom route.</p>
                    <div style="margin-bottom: 1rem; position: relative;">
                        <input type="text" id="mapSearch" placeholder="Search address, zip code, or business name..." style="width: 100%; padding: 1rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 15px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-size: 1rem; font-family: 'Poppins', sans-serif;">
                        <div id="mapSearchSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: rgba(30, 30, 30, 0.98); border: 2px solid rgba(107, 155, 158, 0.3); border-top: none; border-radius: 0 0 15px 15px; max-height: 300px; overflow-y: auto; z-index: 1000; display: none;"></div>
                    </div>
                    <div id="map" style="height: 500px; border-radius: 15px; margin: 1rem 0;"></div>
                    <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                        <button class="feature-btn" onclick="openSaveRouteModal()">Save Route</button>
                        <button class="feature-btn" onclick="clearRoute()">Clear Route</button>
                        <button class="feature-btn" onclick="showToast('Share link copied!')">Share Route</button>
                    </div>
                `;
            } else if (sectionId === 'search') {
                content.innerHTML = `
                    <h2 style="color: var(--accent-color); margin-bottom: 1rem;">Search Routes</h2>
                    <p style="color: #d4d4d4; margin-bottom: 1.5rem;">Find the perfect route for your next adventure</p>
                    <div style="margin-bottom: 1rem; position: relative;">
                        <input type="text" id="searchMapLocation" placeholder="Search address, zip code, or business name..." style="width: 100%; padding: 1rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 15px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-size: 1rem; font-family: 'Poppins', sans-serif; margin-bottom: 1rem;">
                        <div id="searchMapSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: rgba(30, 30, 30, 0.98); border: 2px solid rgba(107, 155, 158, 0.3); border-top: none; border-radius: 0 0 15px 15px; max-height: 300px; overflow-y: auto; z-index: 1000; display: none; margin-top: -1rem;"></div>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <input type="text" id="searchByCategory" placeholder="Search by interest, location, or mood..." style="flex: 1; padding: 1rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 15px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-size: 1rem; font-family: 'Poppins', sans-serif;">
                        <button class="feature-btn" onclick="showToast('Searching routes...')">Search</button>
                    </div>
                    <div id="search-map" style="height: 500px; border-radius: 15px; margin: 1rem 0;"></div>
                    <div id="search-results" style="margin-top: 2rem; color: #d4d4d4;"></div>
                `;
            } else if (sectionId === 'swarms') {
                content.innerHTML = `
                    <h2 style="color: var(--accent-color); margin-bottom: 1rem;">Shopping Swarms</h2>
                    <p style="color: #d4d4d4; margin-bottom: 1.5rem;">Organize or join community walks where locals explore, shop, and support businesses together ‚Äî a spontaneous celebration of local culture!</p>
                    <button class="feature-btn" onclick="openCreateSwarmModal()">Create Shopping Swarm</button>
                    
                    <div style="margin-top: 2rem; margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-light); margin-bottom: 1rem;">üîç Search Near Me</h3>
                        <div style="margin-bottom: 1rem; position: relative;">
                            <input type="text" id="swarmLocationSearch" placeholder="Enter address, zip code, or business name..." style="width: 100%; padding: 1rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 15px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-family: 'Poppins', sans-serif; font-size: 1rem;">
                            <div id="swarmSearchSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: rgba(30, 30, 30, 0.98); border: 2px solid rgba(107, 155, 158, 0.3); border-top: none; border-radius: 0 0 15px 15px; max-height: 300px; overflow-y: auto; z-index: 1000; display: none;"></div>
                        </div>
                        <button class="feature-btn" onclick="showToast('Searching swarms...')">Search</button>
                    </div>
                    
                    <div id="swarm-map" style="height: 500px; border-radius: 15px; margin: 1rem 0;"></div>
                    
                    <h3 style="color: var(--accent-color); margin: 2rem 0 1rem;">Upcoming Shopping Swarms</h3>
                    <div id="swarms-list-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <p style="color: #999; text-align: center; width: 100%; padding: 2rem;">Loading swarms...</p>
                    </div>
                `;
            } else if (sectionId === 'events') {
                content.innerHTML = `
                    <h2 style="color: var(--accent-color); margin-bottom: 1rem;">Local Events</h2>
                    <p style="color: #d4d4d4; margin-bottom: 1.5rem;">Discover and promote neighborhood celebrations, block parties, sidewalk sales, and community festivals.</p>
                    <button class="feature-btn" onclick="openCreateEventModal()">Promote Your Event</button>
                    
                    <div style="margin-top: 2rem; margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-light); margin-bottom: 1rem;">üîç Find Events Near You</h3>
                        <div style="margin-bottom: 1rem; position: relative;">
                            <input type="text" id="eventLocationSearch" placeholder="Enter address, zip code, or business name..." style="width: 100%; padding: 1rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 15px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-family: 'Poppins', sans-serif; font-size: 1rem;">
                            <div id="eventSearchSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: rgba(30, 30, 30, 0.98); border: 2px solid rgba(107, 155, 158, 0.3); border-top: none; border-radius: 0 0 15px 15px; max-height: 300px; overflow-y: auto; z-index: 1000; display: none;"></div>
                        </div>
                        <button class="feature-btn" onclick="showToast('Searching events...')">Search Events</button>
                    </div>
                    
                    <div id="event-map" style="height: 500px; border-radius: 15px; margin: 1rem 0;"></div>
                    
                    <h3 style="color: var(--accent-color); margin: 2rem 0 1rem;">Upcoming Events</h3>
                    <div id="events-list-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <p style="color: #999; text-align: center; width: 100%; padding: 2rem;">Loading events...</p>
                    </div>
                `;
            }
            
            modal.appendChild(closeBtn);
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Initialize maps after DOM is ready
            setTimeout(() => {
                if (sectionId === 'journey-map') {
                    const mapElement = document.getElementById('map');
                    if (mapElement && !journeyMap) {
                        journeyMap = L.map(mapElement).setView([39.7392, -104.9903], 13);
                        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGlnaGRlZnBhbnRzIiwiYSI6ImNtaHpiNGt0NzBsNTIyam9saW45YmQ0Z3gifQ.EPETOMFI41QInYccb4Cehg', {
                            attribution: '¬© Mapbox ¬© OpenStreetMap',
                            tileSize: 512,
                            zoomOffset: -1
                        }).addTo(journeyMap);
                        
                        journeyMap.on('click', function(e) {
                            addWaypoint(e.latlng);
                        });
                        
                        // Add search autocomplete functionality
                        const searchInput = document.getElementById('mapSearch');
                        const suggestionsDiv = document.getElementById('mapSearchSuggestions');
                        let searchTimeout;
                        
                        if (searchInput && suggestionsDiv) {
                            searchInput.addEventListener('input', function(e) {
                                const query = e.target.value.trim();
                                clearTimeout(searchTimeout);
                                
                                if (query.length < 2) {
                                    suggestionsDiv.style.display = 'none';
                                    return;
                                }
                                
                                searchTimeout = setTimeout(() => {
                                    fetchLocationSuggestions(query, suggestionsDiv, journeyMap, searchInput);
                                }, 100);
                            });
                            
                            searchInput.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter' && suggestionsDiv.style.display === 'none') {
                                    searchLocation(searchInput.value, journeyMap);
                                }
                            });
                            
                            document.addEventListener('click', function(e) {
                                if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                                    suggestionsDiv.style.display = 'none';
                                }
                            });
                        }
                    }
                } else if (sectionId === 'search') {
                    const mapElement = document.getElementById('search-map');
                    if (mapElement && !searchMap) {
                        searchMap = L.map(mapElement).setView([39.7392, -104.9903], 13);
                        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGlnaGRlZnBhbnRzIiwiYSI6ImNtaHpiNGt0NzBsNTIyam9saW45YmQ0Z3gifQ.EPETOMFI41QInYccb4Cehg', {
                            attribution: '¬© Mapbox ¬© OpenStreetMap',
                            tileSize: 512,
                            zoomOffset: -1
                        }).addTo(searchMap);
                        
                        // Add search autocomplete functionality
                        const searchInput = document.getElementById('searchMapLocation');
                        const suggestionsDiv = document.getElementById('searchMapSuggestions');
                        let searchTimeout;
                        
                        if (searchInput && suggestionsDiv) {
                            searchInput.addEventListener('input', function(e) {
                                const query = e.target.value.trim();
                                clearTimeout(searchTimeout);
                                
                                if (query.length < 2) {
                                    suggestionsDiv.style.display = 'none';
                                    return;
                                }
                                
                                searchTimeout = setTimeout(() => {
                                    fetchLocationSuggestions(query, suggestionsDiv, searchMap, searchInput);
                                }, 100);
                            });
                            
                            searchInput.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter' && suggestionsDiv.style.display === 'none') {
                                    searchLocation(searchInput.value, searchMap);
                                }
                            });
                            
                            document.addEventListener('click', function(e) {
                                if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                                    suggestionsDiv.style.display = 'none';
                                }
                            });
                        }
                    }
                } else if (sectionId === 'swarms') {
                    const mapElement = document.getElementById('swarm-map');
                    if (mapElement && !swarmMap) {
                        swarmMap = L.map(mapElement).setView([39.7392, -104.9903], 13);
                        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGlnaGRlZnBhbnRzIiwiYSI6ImNtaHpiNGt0NzBsNTIyam9saW45YmQ0Z3gifQ.EPETOMFI41QInYccb4Cehg', {
                            attribution: '¬© Mapbox ¬© OpenStreetMap',
                            tileSize: 512,
                            zoomOffset: -1
                        }).addTo(swarmMap);
                        
                        // Load swarms from Firebase
                        getAllSwarms().then(swarms => {
                            console.log(`Loaded ${swarms.length} swarms from Firebase`);
                            
                            if (swarms.length === 0) {
                                console.log('No swarms found in Firebase');
                                return;
                            }
                            
                            let validCount = 0;
                            let invalidCount = 0;
                            
                            swarms.forEach(swarm => {
                                // Skip swarms without coordinates
                                if (!swarm.lat || !swarm.lng) {
                                    console.warn(`‚ùå Swarm "${swarm.title}" missing coordinates - won't show on map`);
                                    invalidCount++;
                                    return;
                                }
                                
                                validCount++;
                                console.log(`‚úÖ Swarm "${swarm.title}" at [lat: ${swarm.lat}, lng: ${swarm.lng}]`);
                                
                                const isHighlighted = highlightId !== null && swarm.id === highlightId;
                                
                                // Create custom icon for highlighted swarm
                                const markerOptions = {};
                                if (isHighlighted) {
                                    markerOptions.icon = L.icon({
                                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
                                } else {
                                    markerOptions.icon = L.icon({
                                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
                                }
                                
                                const participants = swarm.interested || 0;
                                const marker = L.marker([swarm.lat, swarm.lng], markerOptions).addTo(swarmMap)
                                    .bindPopup(`<strong>${swarm.title}</strong><br>üìç ${swarm.location}<br>üë• ${participants} interested<br>üìÖ ${swarm.date} at ${swarm.time}`);
                                
                                // Auto-open popup for highlighted swarm
                                if (isHighlighted) {
                                    marker.openPopup();
                                    swarmMap.setView([swarm.lat, swarm.lng], 15);
                                }
                            });
                            
                            console.log(`üìä Swarms Map: ${validCount} shown, ${invalidCount} skipped (no coordinates)`);
                            
                            // Load swarms list below map
                            loadSwarmsListInModal(swarms);
                        });
                        
                        // Add search autocomplete functionality for swarms
                        const swarmSearchInput = document.getElementById('swarmLocationSearch');
                        const swarmSuggestionsDiv = document.getElementById('swarmSearchSuggestions');
                        let swarmSearchTimeout;
                        
                        if (swarmSearchInput && swarmSuggestionsDiv) {
                            swarmSearchInput.addEventListener('input', function(e) {
                                const query = e.target.value.trim();
                                clearTimeout(swarmSearchTimeout);
                                
                                if (query.length < 2) {
                                    swarmSuggestionsDiv.style.display = 'none';
                                    return;
                                }
                                
                                swarmSearchTimeout = setTimeout(() => {
                                    fetchLocationSuggestions(query, swarmSuggestionsDiv, swarmMap, swarmSearchInput);
                                }, 100);
                            });
                            
                            swarmSearchInput.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter' && swarmSuggestionsDiv.style.display === 'none') {
                                    searchLocation(swarmSearchInput.value, swarmMap);
                                }
                            });
                            
                            document.addEventListener('click', function(e) {
                                if (!swarmSearchInput.contains(e.target) && !swarmSuggestionsDiv.contains(e.target)) {
                                    swarmSuggestionsDiv.style.display = 'none';
                                }
                            });
                        }
                    }
                } else if (sectionId === 'events') {
                    // Initialize event map
                    const eventMapElement = document.getElementById('event-map');
                    if (eventMapElement && !eventMap) {
                        eventMap = L.map(eventMapElement).setView([39.7392, -104.9903], 13);
                        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGlnaGRlZnBhbnRzIiwiYSI6ImNtaHpiNGt0NzBsNTIyam9saW45YmQ0Z3gifQ.EPETOMFI41QInYccb4Cehg', {
                            attribution: '¬© Mapbox ¬© OpenStreetMap',
                            tileSize: 512,
                            zoomOffset: -1
                        }).addTo(eventMap);
                        
                        // Load events from Firebase
                        getAllEvents().then(events => {
                            console.log(`Loaded ${events.length} events from Firebase`);
                            
                            if (events.length === 0) {
                                console.log('No events found in Firebase');
                                return;
                            }
                            
                            let validCount = 0;
                            let invalidCount = 0;
                            
                            events.forEach(event => {
                                // Skip events without coordinates
                                if (!event.lat || !event.lng) {
                                    console.warn(`‚ùå Event "${event.name}" missing coordinates - won't show on map`);
                                    invalidCount++;
                                    return;
                                }
                                
                                validCount++;
                                console.log(`‚úÖ Event "${event.name}" at [lat: ${event.lat}, lng: ${event.lng}]`);
                                
                                const isHighlighted = highlightId !== null && event.id === highlightId;
                                
                                // Create custom icon for highlighted event
                                const markerOptions = {};
                                if (isHighlighted) {
                                    markerOptions.icon = L.icon({
                                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
                                } else {
                                    markerOptions.icon = L.icon({
                                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
                                }
                                
                                const marker = L.marker([event.lat, event.lng], markerOptions).addTo(eventMap)
                                    .bindPopup(`<strong>${event.name}</strong><br>${event.type}<br>üìç ${event.location}<br>üìÖ ${event.startDate} at ${event.startTime}`);
                                
                                // Auto-open popup for highlighted event
                                if (isHighlighted) {
                                    marker.openPopup();
                                    eventMap.setView([event.lat, event.lng], 15);
                                }
                            });
                            
                            console.log(`üìä Events Map: ${validCount} shown, ${invalidCount} skipped (no coordinates)`);
                            
                            // Load events list below map
                            loadEventsListInModal(events);
                        });
                    }
                    
                    // Add autocomplete for events search
                    const eventSearchInput = document.getElementById('eventLocationSearch');
                    const eventSuggestionsDiv = document.getElementById('eventSearchSuggestions');
                    let eventSearchTimeout;
                    
                    if (eventSearchInput && eventSuggestionsDiv) {
                        eventSearchInput.addEventListener('input', function(e) {
                            const query = e.target.value.trim();
                            clearTimeout(eventSearchTimeout);
                            
                            if (query.length < 2) {
                                eventSuggestionsDiv.style.display = 'none';
                                return;
                            }
                            
                            eventSearchTimeout = setTimeout(() => {
                                fetchLocationSuggestions(query, eventSuggestionsDiv, eventMap, eventSearchInput);
                            }, 100);
                        });
                        
                        eventSearchInput.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter' && eventSuggestionsDiv.style.display === 'none') {
                                searchLocation(eventSearchInput.value, eventMap);
                            }
                        });
                        
                        document.addEventListener('click', function(e) {
                            if (!eventSearchInput.contains(e.target) && !eventSuggestionsDiv.contains(e.target)) {
                                eventSuggestionsDiv.style.display = 'none';
                            }
                        });
                    }
                }
            }, 300);
        }
        
        // Make toggleSection globally accessible immediately
        window.toggleSection = toggleSection;
        
        function addWaypoint(latlng) {
            const waypointNumber = routeCoordinates.length + 1;
            const numberIcon = L.divIcon({
                className: 'numbered-marker',
                html: `<div style="background: var(--accent-color); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">${waypointNumber}</div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });
            
            const marker = L.marker(latlng, { icon: numberIcon }).addTo(journeyMap);
            routeMarkers.push(marker);
            routeCoordinates.push([latlng.lat, latlng.lng]);
            
            if (routePath) {
                journeyMap.removeLayer(routePath);
            }
            
            if (routeCoordinates.length > 1) {
                routePath = L.polyline(routeCoordinates, { color: 'var(--accent-color)', weight: 4 }).addTo(journeyMap);
            }
            
            showToast(`Waypoint ${waypointNumber} added!`);
        }
        
        function clearRoute() {
            routeMarkers.forEach(marker => journeyMap.removeLayer(marker));
            if (routePath) journeyMap.removeLayer(routePath);
            routeMarkers = [];
            routeCoordinates = [];
            routePath = null;
            showToast('Route cleared!');
        }
        
        // Fetch location suggestions using Mapbox Geocoding API
        function fetchLocationSuggestions(query, suggestionsDiv, map, inputElement) {
            const accessToken = 'pk.eyJ1IjoiaGlnaGRlZnBhbnRzIiwiYSI6ImNtaHpiNGt0NzBsNTIyam9saW45YmQ0Z3gifQ.EPETOMFI41QInYccb4Cehg';
            const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${accessToken}&country=us&limit=8&types=place,address,poi`;
            
            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.features && data.features.length > 0) {
                    suggestionsDiv.innerHTML = '';
                    data.features.forEach(result => {
                        const item = document.createElement('div');
                        item.style.cssText = 'padding: 1rem; color: #d4d4d4; cursor: pointer; border-bottom: 1px solid rgba(107, 155, 158, 0.1); transition: background 0.2s;';
                        item.onmouseover = () => item.style.background = 'rgba(107, 155, 158, 0.2)';
                        item.onmouseout = () => item.style.background = '';
                        
                        const main = document.createElement('div');
                        main.style.cssText = 'font-weight: 600; color: var(--accent-light);';
                        main.textContent = result.text || result.place_name.split(',')[0];
                        
                        const detail = document.createElement('div');
                        detail.style.cssText = 'font-size: 0.9rem; color: #999; margin-top: 0.2rem;';
                        detail.textContent = result.place_name;
                        
                        item.appendChild(main);
                        item.appendChild(detail);
                        
                        item.addEventListener('click', function() {
                            const lon = result.center[0];
                            const lat = result.center[1];
                            
                            // Only update map if map exists
                            if (map) {
                                map.setView([lat, lon], 15);
                                L.marker([lat, lon])
                                    .addTo(map)
                                    .bindPopup(`<strong>${result.place_name}</strong>`)
                                    .openPopup();
                            }
                            
                            suggestionsDiv.style.display = 'none';
                            inputElement.value = result.place_name;
                            showToast(`Found: ${result.text}`);
                        });
                        
                        suggestionsDiv.appendChild(item);
                    });
                    suggestionsDiv.style.display = 'block';
                } else {
                    suggestionsDiv.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Autocomplete error:', error);
                suggestionsDiv.style.display = 'none';
            });
        }
        
        // Search location using Mapbox Geocoding API
        function searchLocation(query, map) {
            if (!query || query.trim() === '') {
                showToast('Please enter a location to search');
                return;
            }
            
            const accessToken = 'pk.eyJ1IjoiaGlnaGRlZnBhbnRzIiwiYSI6ImNtaHpiNGt0NzBsNTIyam9saW45YmQ0Z3gifQ.EPETOMFI41QInYccb4Cehg';
            const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${accessToken}&country=us&limit=1`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.features && data.features.length > 0) {
                        const result = data.features[0];
                        const lon = result.center[0];
                        const lat = result.center[1];
                        
                        const isZipCode = /^\d{5}$/.test(query.trim());
                        const zoom = isZipCode ? 13 : 15;
                        
                        map.setView([lat, lon], zoom);
                        
                        L.marker([lat, lon])
                            .addTo(map)
                            .bindPopup(`<strong>${result.place_name}</strong>`)
                            .openPopup();
                        
                        const locationName = result.text || result.place_name.split(',')[0];
                        showToast(`Found: ${locationName}`);
                    } else {
                        showToast('Location not found. Try being more specific.');
                    }
                })
                .catch(error => {
                    console.error('Search error:', error);
                    showToast('Search failed. Please try again.');
                });
        }
        
        // Open Save Route Modal
        function openSaveRouteModal() {
            if (routeCoordinates.length < 2) {
                showToast('Please add at least 2 waypoints!');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'saveRouteModal';
            modal.style.cssText = 'position: fixed; z-index: 10001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center;';
            
            modal.innerHTML = `
                <div style="background: rgba(25, 25, 25, 0.98); border-radius: 20px; padding: 2rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; border: 2px solid rgba(107, 155, 158, 0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--accent-color);">Save Your Route</h2>
                        <span onclick="document.getElementById('saveRouteModal').remove()" style="font-size: 2rem; color: #d4d4d4; cursor: pointer; transition: color 0.3s;">&times;</span>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 500;">Route Name *</label>
                        <input type="text" id="routeName" placeholder="e.g., Morning Coffee Trail" style="width: 100%; padding: 0.8rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-family: 'Poppins', sans-serif;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 500;">Description</label>
                        <textarea id="routeDescription" rows="3" placeholder="Describe your route..." style="width: 100%; padding: 0.8rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-family: 'Poppins', sans-serif;"></textarea>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 500;">Category</label>
                        <select id="routeCategory" style="width: 100%; padding: 0.8rem; border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; background: rgba(40, 40, 40, 0.9); color: #e0e0e0; font-family: 'Poppins', sans-serif;">
                            <option value="">Select a category...</option>
                            <option value="coffee">‚òï Coffee Shops</option>
                            <option value="tacos">üåÆ Tacos & Mexican</option>
                            <option value="food">üç¥ Food & Dining</option>
                            <option value="bars">üç∫ Bars & Nightlife</option>
                            <option value="bookstores">üìö Bookstores</option>
                            <option value="shopping">üõçÔ∏è Shopping & Boutiques</option>
                            <option value="clothing">üëï Clothing & Fashion</option>
                            <option value="art">üé® Art & Culture</option>
                            <option value="parks">üå≥ Parks & Nature</option>
                            <option value="historic">üèõÔ∏è Historic Sites</option>
                            <option value="other">‚ú® Other</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                        <button onclick="document.getElementById('saveRouteModal').remove()" style="padding: 0.8rem 2rem; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; background: rgba(60, 60, 60, 0.9); color: #d4d4d4;">Cancel</button>
                        <button onclick="confirmSaveRoute()" style="padding: 0.8rem 2rem; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; background: linear-gradient(135deg, var(--accent-color), var(--accent-light)); color: white;">Save Route</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        async function confirmSaveRoute() {
            const name = document.getElementById('routeName').value;
            if (!name) {
                showToast('Please enter a route name!');
                return;
            }
            
            if (routeCoordinates.length < 2) {
                showToast('Please add at least 2 waypoints to your route!');
                return;
            }
            
            const description = document.getElementById('routeDescription')?.value || '';
            const category = document.getElementById('routeCategory')?.value || '';
            
            const routeData = {
                name: name,
                description: description,
                category: category,
                waypoints: routeCoordinates,
                waypointCount: routeCoordinates.length,
                created: new Date().toISOString(),
                createdBy: 'anonymous' // Could add user auth later
            };
            
            console.log('üíæ Attempting to save route:', routeData);
            
            // Save to Firebase
            try {
                if (!window.database) {
                    throw new Error('Firebase database not initialized');
                }
                
                const routesRef = window.database.ref('routes');
                await routesRef.push(routeData);
                console.log('‚úÖ Route saved to Firebase:', routeData);
                
                document.getElementById('saveRouteModal').remove();
                showToast(`Route "${name}" saved successfully!`);
            } catch (error) {
                console.error('‚ùå Error saving route:', error);
                console.error('Route data:', routeData);
                showToast('Error saving route: ' + error.message);
            }
        }
        
        // Make route functions globally accessible
        window.clearRoute = clearRoute;
        window.openSaveRouteModal = openSaveRouteModal;
        window.confirmSaveRoute = confirmSaveRoute;
        
        // Toast Notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = 'position: fixed; bottom: 2rem; right: 2rem; background: rgba(107, 155, 158, 0.95); color: white; padding: 1rem 2rem; border-radius: 10px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3); z-index: 3000;';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        window.showToast = showToast;

        // Modal Functions
        function openCreateSwarmModal() {
            document.getElementById('createSwarmModal').style.display = 'flex';
        }

        function closeCreateSwarmModal() {
            document.getElementById('createSwarmModal').style.display = 'none';
            document.getElementById('createSwarmForm').reset();
        }

        function openCreateEventModal() {
            document.getElementById('createEventModal').style.display = 'flex';
        }

        function closeCreateEventModal() {
            document.getElementById('createEventModal').style.display = 'none';
            document.getElementById('createEventForm').reset();
            document.getElementById('customEventTypeField').style.display = 'none';
        }
        
        function toggleCustomEventType() {
            const select = document.getElementById('eventTypeSelect');
            const customField = document.getElementById('customEventTypeField');
            const customInput = document.getElementById('customEventType');
            
            if (select.value === 'Other') {
                customField.style.display = 'block';
                customInput.required = true;
            } else {
                customField.style.display = 'none';
                customInput.required = false;
                customInput.value = '';
            }
        }
        
        // Make modal functions globally accessible
        window.openCreateSwarmModal = openCreateSwarmModal;
        window.closeCreateSwarmModal = closeCreateSwarmModal;
        window.openCreateEventModal = openCreateEventModal;
        window.closeCreateEventModal = closeCreateEventModal;
        window.toggleCustomEventType = toggleCustomEventType;

        // Submit handlers
        async function submitSwarm(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const locationText = formData.get('swarmLocation');
            
            // Geocode the location to get coordinates
            showToast('Getting location coordinates...');
            const coordinates = await geocodeAddress(locationText);
            
            if (!coordinates) {
                showToast('Could not find that location. Please be more specific.');
                return;
            }
            
            const swarmData = {
                title: formData.get('swarmTitle'),
                location: locationText,
                locationFull: coordinates.fullAddress,
                lat: coordinates.lat,
                lng: coordinates.lng,
                date: formData.get('swarmDate'),
                time: formData.get('swarmTime'),
                description: formData.get('swarmDescription'),
                contact: formData.get('swarmContact'),
                duration: formData.get('swarmDuration'),
                identifier: formData.get('swarmIdentifier'),
                interested: 0
            };
            
            // Save to Firebase (also keeps localStorage as backup)
            saveSwarmToFirebase(swarmData);
            
            // Also save to localStorage as backup
            let swarms = JSON.parse(localStorage.getItem('swarms') || '[]');
            swarms.push(swarmData);
            localStorage.setItem('swarms', JSON.stringify(swarms));
            
            showToast('Shopping Swarm created successfully!');
            closeCreateSwarmModal();
            // Don't auto-navigate - user can manually go to swarms to see it
        }

        async function submitEvent(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            // Get event type - use custom if "Other" was selected
            let eventType = formData.get('eventType');
            if (eventType === 'Other') {
                eventType = document.getElementById('customEventType').value;
            }
            
            const locationText = formData.get('eventLocation');
            
            // Geocode the location to get coordinates
            showToast('Getting location coordinates...');
            const coordinates = await geocodeAddress(locationText);
            
            if (!coordinates) {
                showToast('Could not find that location. Please be more specific.');
                return;
            }
            
            const eventData = {
                name: formData.get('eventName'),
                type: eventType,
                location: locationText,
                locationFull: coordinates.fullAddress,
                lat: coordinates.lat,
                lng: coordinates.lng,
                startDate: formData.get('eventStartDate'),
                startTime: formData.get('eventStartTime'),
                endDate: formData.get('eventEndDate'),
                endTime: formData.get('eventEndTime'),
                description: formData.get('eventDescription'),
                contact: formData.get('eventContact'),
                website: formData.get('eventWebsite'),
                maxParticipants: formData.get('eventMaxParticipants'),
                postedBy: formData.get('eventPostedBy'),
                interested: 0
            };
            
            // Save to Firebase (also keeps localStorage as backup)
            saveEventToFirebase(eventData);
            
            // Also save to localStorage as backup
            let events = JSON.parse(localStorage.getItem('events') || '[]');
            events.push(eventData);
            localStorage.setItem('events', JSON.stringify(events));
            
            showToast('Event created successfully!');
            closeCreateEventModal();
            // Don't auto-navigate - user can manually go to events to see it
        }

        // Interest counter
        function addInterest(type, id) {
            // Update the displayed count
            const countElement = document.getElementById(`${type}-interest-${id}`);
            if (countElement) {
                // Extract current count from text
                const currentText = countElement.textContent;
                const currentCount = parseInt(currentText.match(/\d+/)[0]) || 0;
                const newCount = currentCount + 1;
                countElement.textContent = `üë• ${newCount} locals interested`;
                showToast('Thanks for your interest!');
                
                // Update Firebase (if id is a Firebase key, not array index)
                if (typeof id === 'string' && id.includes('-')) {
                    updateInterestCount(type, id, newCount);
                }
                
                // Also save to localStorage if this is a stored item
                const key = type === 'swarm' ? 'swarms' : 'events';
                let items = JSON.parse(localStorage.getItem(key) || '[]');
                if (items[id]) {
                    items[id].interested = newCount;
                    localStorage.setItem(key, JSON.stringify(items));
                }
                
                // Navigate to the map section with highlighted item
                const sectionName = type === 'swarm' ? 'swarms' : 'events';
                setTimeout(() => {
                    toggleSection(sectionName, id);
                }, 500);
            }
        }

        // Share functionality
        function shareItem(title, url) {
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: url || window.location.href
                }).catch(() => {});
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(url || window.location.href);
                showToast('Link copied to clipboard!');
            }
        }
        
        // Make submit and interaction functions globally accessible
        window.submitSwarm = submitSwarm;
        window.submitEvent = submitEvent;
        window.addInterest = addInterest;
        window.shareItem = shareItem;

        // Format date display
        function formatDateDisplay(dateStr) {
            const eventDate = new Date(dateStr);
            const now = new Date();
            const currentWeekStart = new Date(now.setDate(now.getDate() - now.getDay()));
            const currentWeekEnd = new Date(currentWeekStart);
            currentWeekEnd.setDate(currentWeekEnd.getDate() + 6);
            
            if (eventDate >= currentWeekStart && eventDate <= currentWeekEnd) {
                // Within current week - show day name
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                return days[eventDate.getDay()];
            } else {
                // Beyond current week - show full date
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return `${months[eventDate.getMonth()]} ${eventDate.getDate()}`;
            }
        }
        
        // ===== LOAD LISTS IN MODALS =====
        
        function loadSwarmsListInModal(swarms) {
            const container = document.getElementById('swarms-list-container');
            if (!container) return;
            
            // Filter swarms that have coordinates
            const validSwarms = swarms.filter(s => s.lat && s.lng);
            
            if (validSwarms.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; width: 100%; padding: 2rem;">No swarms yet. Be the first to create one!</p>';
                return;
            }
            
            container.innerHTML = '';
            validSwarms.forEach(swarm => {
                const card = document.createElement('div');
                card.style.cssText = 'background: rgba(40, 40, 40, 0.8); padding: 1.5rem; border-radius: 15px; cursor: pointer; transition: transform 0.2s;';
                card.innerHTML = `
                    <h4 style="color: var(--accent-color); margin-bottom: 0.5rem;">${swarm.title}</h4>
                    <p style="color: #d4d4d4; margin: 0.5rem 0;">üìÖ ${swarm.date} at ${swarm.time}</p>
                    <p style="color: #d4d4d4; margin: 0.5rem 0;">üìç ${swarm.location}</p>
                    <p style="color: var(--accent-light); font-weight: 600; margin-top: 0.8rem;">üë• ${swarm.interested || 0} interested</p>
                `;
                card.addEventListener('click', () => {
                    // Find marker and open popup
                    swarmMap.eachLayer(layer => {
                        if (layer instanceof L.Marker) {
                            const latlng = layer.getLatLng();
                            if (Math.abs(latlng.lat - swarm.lat) < 0.0001 && Math.abs(latlng.lng - swarm.lng) < 0.0001) {
                                swarmMap.setView([swarm.lat, swarm.lng], 15);
                                layer.openPopup();
                            }
                        }
                    });
                });
                card.addEventListener('mouseenter', () => card.style.transform = 'translateY(-4px)');
                card.addEventListener('mouseleave', () => card.style.transform = 'translateY(0)');
                container.appendChild(card);
            });
        }
        
        function loadEventsListInModal(events) {
            const container = document.getElementById('events-list-container');
            if (!container) return;
            
            // Filter events that have coordinates
            const validEvents = events.filter(e => e.lat && e.lng);
            
            if (validEvents.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; width: 100%; padding: 2rem;">No events yet. Be the first to promote one!</p>';
                return;
            }
            
            container.innerHTML = '';
            validEvents.forEach(event => {
                const card = document.createElement('div');
                card.style.cssText = 'background: rgba(40, 40, 40, 0.8); padding: 1.5rem; border-radius: 15px; cursor: pointer; transition: transform 0.2s;';
                card.innerHTML = `
                    <span style="display: inline-block; background: var(--accent-light); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.75rem; margin-bottom: 0.8rem; font-weight: 600;">${event.type}</span>
                    <h4 style="color: var(--accent-color); margin-bottom: 0.5rem;">${event.name}</h4>
                    <p style="color: #d4d4d4; margin: 0.5rem 0;">üìÖ ${event.startDate} at ${event.startTime}</p>
                    <p style="color: #d4d4d4; margin: 0.5rem 0;">üìç ${event.location}</p>
                    <p style="color: var(--accent-light); font-weight: 600; margin-top: 0.8rem;">üë• ${event.interested || 0} interested</p>
                `;
                card.addEventListener('click', () => {
                    // Find marker and open popup
                    eventMap.eachLayer(layer => {
                        if (layer instanceof L.Marker) {
                            const latlng = layer.getLatLng();
                            if (Math.abs(latlng.lat - event.lat) < 0.0001 && Math.abs(latlng.lng - event.lng) < 0.0001) {
                                eventMap.setView([event.lat, event.lng], 15);
                                layer.openPopup();
                            }
                        }
                    });
                });
                card.addEventListener('mouseenter', () => card.style.transform = 'translateY(-4px)');
                card.addEventListener('mouseleave', () => card.style.transform = 'translateY(0)');
                container.appendChild(card);
            });
        }

        // === FINAL SAFETY CHECK - Ensure all functions are globally accessible ===
        if (typeof toggleSection !== 'undefined') window.toggleSection = toggleSection;
        if (typeof showToast !== 'undefined') window.showToast = showToast;
        if (typeof openCreateSwarmModal !== 'undefined') window.openCreateSwarmModal = openCreateSwarmModal;
        if (typeof closeCreateSwarmModal !== 'undefined') window.closeCreateSwarmModal = closeCreateSwarmModal;
        if (typeof openCreateEventModal !== 'undefined') window.openCreateEventModal = openCreateEventModal;
        if (typeof closeCreateEventModal !== 'undefined') window.closeCreateEventModal = closeCreateEventModal;
        if (typeof submitSwarm !== 'undefined') window.submitSwarm = submitSwarm;
        if (typeof submitEvent !== 'undefined') window.submitEvent = submitEvent;
        if (typeof addInterest !== 'undefined') window.addInterest = addInterest;
        if (typeof shareItem !== 'undefined') window.shareItem = shareItem;
        if (typeof clearRoute !== 'undefined') window.clearRoute = clearRoute;
        if (typeof openSaveRouteModal !== 'undefined') window.openSaveRouteModal = openSaveRouteModal;
        if (typeof confirmSaveRoute !== 'undefined') window.confirmSaveRoute = confirmSaveRoute;
        if (typeof toggleCustomEventType !== 'undefined') window.toggleCustomEventType = toggleCustomEventType;
        
        console.log('‚úÖ All functions loaded and globally accessible');
        console.log('toggleSection available:', typeof window.toggleSection);
    </script>

    <!-- Create Swarm Modal -->
    <div id="createSwarmModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center; padding: 2rem;">
        <div style="background: rgba(25, 25, 25, 0.98); border-radius: 20px; padding: 2.5rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; border: 2px solid rgba(107, 155, 158, 0.3); position: relative;">
            <button onclick="closeCreateSwarmModal()" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--accent-color); font-size: 2rem; cursor: pointer; line-height: 1;">&times;</button>
            
            <h2 style="color: var(--accent-color); margin-bottom: 1.5rem; font-family: 'Playfair Display', serif;">Create Shopping Swarm</h2>
            
            <form id="createSwarmForm" onsubmit="submitSwarm(event)">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Title *</label>
                    <input type="text" name="swarmTitle" required maxlength="60" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="Saturday Market Crawl">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Starting Location *</label>
                    <input type="text" name="swarmLocation" required style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="Downtown Farmers Market">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Date *</label>
                        <input type="date" name="swarmDate" required style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                    </div>
                    <div>
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Time *</label>
                        <input type="time" name="swarmTime" required style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Expected Duration</label>
                    <select name="swarmDuration" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                        <option value="">Select duration...</option>
                        <option value="1 hour">1 hour</option>
                        <option value="2 hours">2 hours</option>
                        <option value="3+ hours">3+ hours</option>
                    </select>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Description (200 characters max)</label>
                    <p style="color: #999; font-size: 0.85rem; margin-bottom: 0.5rem;">This will be visible to others when viewing swarms</p>
                    <textarea name="swarmDescription" maxlength="200" rows="3" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem; resize: vertical;" placeholder="Hitting 3 coffee shops in the Arts District"></textarea>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">How to Identify Group (Optional)</label>
                    <input type="text" name="swarmIdentifier" maxlength="100" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="e.g., 'Blue umbrella' or 'Wearing yellow shirts'">
                    <p style="color: #999; font-size: 0.85rem; margin-top: 0.5rem;">Help others recognize your group at the meeting location</p>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Contact (Optional)</label>
                    <input type="text" name="swarmContact" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="email@example.com or phone">
                </div>

                <button type="submit" class="feature-btn" style="width: 100%; margin-top: 1rem;">Create Swarm</button>
            </form>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div id="createEventModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center; padding: 2rem;">
        <div style="background: rgba(25, 25, 25, 0.98); border-radius: 20px; padding: 2.5rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; border: 2px solid rgba(107, 155, 158, 0.3); position: relative;">
            <button onclick="closeCreateEventModal()" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--accent-color); font-size: 2rem; cursor: pointer; line-height: 1;">&times;</button>
            
            <h2 style="color: var(--accent-color); margin-bottom: 1.5rem; font-family: 'Playfair Display', serif;">Promote Your Event</h2>
            
            <form id="createEventForm" onsubmit="submitEvent(event)">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Event Name *</label>
                    <input type="text" name="eventName" required maxlength="80" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="Highland Street Festival">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Event Type *</label>
                    <select id="eventTypeSelect" name="eventType" required onchange="toggleCustomEventType()" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                        <option value="">Select type...</option>
                        <option value="Block Party">Block Party</option>
                        <option value="Art Walk">Art Walk</option>
                        <option value="Sidewalk Sale">Sidewalk Sale</option>
                        <option value="Market">Market</option>
                        <option value="Festival">Festival</option>
                        <option value="Concert">Concert</option>
                        <option value="Parade">Parade</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div id="customEventTypeField" style="margin-bottom: 1.5rem; display: none;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Custom Event Type *</label>
                    <input type="text" id="customEventType" maxlength="50" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="Enter custom event type">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Location *</label>
                    <input type="text" name="eventLocation" required style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="Highland Neighborhood">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Start Date *</label>
                        <input type="date" name="eventStartDate" required style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                    </div>
                    <div>
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Start Time *</label>
                        <input type="time" name="eventStartTime" required style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">End Date</label>
                        <input type="date" name="eventEndDate" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                    </div>
                    <div>
                        <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">End Time</label>
                        <input type="time" name="eventEndTime" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;">
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Description * (500 characters max)</label>
                    <textarea name="eventDescription" required maxlength="500" rows="4" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem; resize: vertical;" placeholder="Describe your event..."></textarea>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Posted By *</label>
                    <input type="text" name="eventPostedBy" required maxlength="60" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="Organization or your name">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Contact Info (Optional)</label>
                    <input type="text" name="eventContact" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="email@example.com or phone">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Website/Link (Optional)</label>
                    <input type="text" name="eventWebsite" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="www.example.com or https://example.com">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #d4d4d4; margin-bottom: 0.5rem; font-weight: 600;">Max Participants (Optional)</label>
                    <input type="number" name="eventMaxParticipants" min="1" style="width: 100%; padding: 0.8rem; background: rgba(40, 40, 40, 0.8); border: 2px solid rgba(107, 155, 158, 0.3); border-radius: 10px; color: white; font-size: 1rem;" placeholder="Leave blank for unlimited">
                </div>

                <button type="submit" class="feature-btn" style="width: 100%; margin-top: 1rem;">Create Event</button>
            </form>
        </div>
    </div>
</body>
</html>
